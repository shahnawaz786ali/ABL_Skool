{% extends "base.html" %}

{% block body %}
<!-- payment_form.html -->
<form id="payment-form" action="{% url 'users:payment_view' %}" method="POST">
    {% csrf_token %}
    <label for="amount">Enter Amount:</label>
    <input type="number" id="amount" name="amount" placeholder="Enter amount" required>
    
    <label for="card-number">Card Number:</label>
    <input type="text" id="card-number" name="card-number" placeholder="Card number" required>
    
    <label for="expiry">Expiration Date:</label>
    <input type="text" id="expiry" name="expiry" placeholder="MM/YY" required>
    
    <label for="cvc">CVC:</label>
    <input type="text" id="cvc" name="cvc" placeholder="CVC" required>
    <button id="pay-button">Pay</button>
</form>
{% endblock %}

{% block js %}
<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');

    document.getElementById('pay-button').addEventListener('click', function(event) {
        event.preventDefault();
        var amount = document.querySelector('input[name="amount"]').value;

        fetch('/payment/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ amount: amount })
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            return stripe.confirmCardPayment(data.clientSecret, {
                payment_method: {
                    card: card,  // 'card' should be the card object obtained from the form
                    billing_details: {
                        // Add billing details if required
                    }
                }
            });
        })
        .then(function(result) {
            // Handle success/failure of payment confirmation
        });
    });
</script>
{% endblock %}